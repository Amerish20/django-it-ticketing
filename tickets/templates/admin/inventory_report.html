{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Inventory Report{% endblock %}

{% block content %}
<div id="content-main" class="module">
    <h1>Inventory Report</h1>

    <form method="get" class="form-inline" style="margin-bottom: 20px;">
        <label>User:</label>
        <select name="user" class="form-control" style="margin-right: 10px;">
            <option value="">All</option>
            {% for user in users %}
                <option value="{{ user.id }}" {% if request.GET.user == user.id|stringformat:"s" %}selected{% endif %}>
                    {{ user.name }}
                </option>
            {% endfor %}
        </select>

        <label>Item:</label>
        <select name="inventory_item" class="form-control" style="margin-right: 10px;">
            <option value="">All</option>
            {% for item in items %}
                <option value="{{ item.id }}" {% if request.GET.inventory_item == item.id|stringformat:"s" %}selected{% endif %}>
                    {{ item.name }}
                </option>
            {% endfor %}
        </select>

        <label>Department:</label>
        <select name="department" class="form-control" style="margin-right: 10px;">
            <option value="">All</option>
            {% for department in departments %}
                <option value="{{ department.id }}" {% if request.GET.department == department.id|stringformat:"s" %}selected{% endif %}>
                    {{ department.name }}
                </option>
            {% endfor %}
        </select>

        <label>From:</label>
        <input type="date" name="from_date" class="form-control" value="{{ request.GET.from_date }}" style="margin-right: 10px;">

        <label>To:</label>
        <input type="date" name="to_date" class="form-control" value="{{ request.GET.to_date }}" style="margin-right: 10px;">

        <button type="submit" class="btn btn-primary">Submit</button>
        <div style="margin-top: 20px;">
            <a href="?user={{ request.GET.user }}&department={{ request.GET.department }}&inventory_item={{ request.GET.inventory_item }}&from_date={{ request.GET.from_date }}&to_date={{ request.GET.to_date }}&export=pdf" 
            class="button" style="margin-right: 10px; padding: 6px 12px; background-color: #dc3545; color: #fff; border: none; border-radius: 4px; text-decoration: none;">
                Download PDF
            </a>

            {% comment %} <a href="?user={{ request.GET.user }}&department={{ request.GET.department }}&inventory_item={{ request.GET.inventory_item }}&from_date={{ request.GET.from_date }}&to_date={{ request.GET.to_date }}&export=excel" 
            class="button" style="padding: 6px 12px; background-color: #28a745; color: #fff; border: none; border-radius: 4px; text-decoration: none;">
                Download Excel
            </a> {% endcomment %}
        </div>
    </form>

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>#</th>
                {% if not request.GET.user %}
                <th>User Info</th>
                {% endif %}
                <th style="width: 15%;">Item Name</th>
                <th>Serial No</th>
                <th>Asset Code</th>
                <th>Issue Date</th>
                <th>User Sign</th>
                <th>Return Date</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for inv in inventories %}
            <tr>
                <td>{{ forloop.counter }}</td>
                {% if not request.GET.user %}
                <td>
                <strong>{{ inv.user.name }}</strong><br>
                Batch: {{ inv.user.batch_number }}<br>
                Dept: {{ inv.user.department.name }}
                </td>
                {% endif %}
                <td>{{ inv.inventory_item.name }}</td>
                <td>{{ inv.inventory_item.serial_number }}</td>
                <td>{{ inv.inventory_item.asset_code }}</td>
                <td>{{ inv.issue_date }}</td>
                <td style="height: 40px;">&nbsp;</td>
                <td>{% if inv.return_date %}{{ inv.return_date }}{% else %}&nbsp;<br><br>{% endif %}</td>
                <td>{% if inv.remarks %}{{ inv.remarks }}{% else %}&nbsp;<br><br>{% endif %}</td>
            </tr>
            {% empty %}
            <tr><td colspan="7">No records found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
